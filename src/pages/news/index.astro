---
import { getCollection } from "astro:content";
import Layout from '../../layouts/Layout.astro';
import NewsList from '../../components/NewsList.astro';

// ニュース記事の取得とサマリー生成
const posts = await getCollection("news");
// @ts-ignore
const withExcerpt = posts
  .filter((post: any) => !post.data.draft) // 下書きを除外
  .sort((a: any, b: any) => b.data.date.getTime() - a.data.date.getTime()) // 日付で降順ソート
  .map((post: any) => {
    // Markdownの生テキストからサマリーを生成
    const bodyText = post.body
      .replace(/^#+\s*/gm, '') // 見出し記号を削除
      .replace(/\*\*(.*?)\*\*/g, '$1') // 太字記号を削除
      .replace(/\*(.*?)\*/g, '$1') // 斜体記号を削除
      .replace(/`(.*?)`/g, '$1') // インラインコード記号を削除
      .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1') // リンク記号を削除
      .replace(/^\s*[-*+]\s*/gm, '') // リスト記号を削除
      .replace(/\n+/g, ' ') // 改行を空白に変換
      .replace(/\s+/g, ' ') // 連続する空白を1つに
      .trim();
    
    const excerpt = bodyText.slice(0, 150);
    return { ...post, excerpt };
  });
---

<Layout title="ニュース - 株式会社RISE VISTA">
  <div class="bg-primary-back">
    <!-- ヘッダーセクション -->
    <section class="pt-48 bg-primary-back grid-lines">
      <div class="max-w-6xl mx-auto px-4">
        <div class="mb-12">
          <div class="flex items-center mb-1">
            <div class="black-bar mr-4"></div>
            <p class="text-sm md:text-base tracking-wider">最新情報</p>
          </div>
          <h1 class="text-6xl font-bold tracking-widest font-tsukushi text-primary">NEWS</h1>
        </div>
      </div>
    </section>

    <!-- ニュース記事一覧 -->
    <section class="py-24 bg-primary-back">
      <div class="max-w-6xl mx-auto px-4">
        <NewsList items={withExcerpt} basePath="/news" />
      </div>
    </section>

    <!-- ホームに戻るリンク -->
    <section class="py-12 bg-primary-back">
      <div class="max-w-6xl mx-auto px-4 text-center">
        <a 
          href="/" 
          class="inline-flex items-center text-teal-600 hover:text-teal-800 font-medium font-tsukushi"
        >
          ← ホームに戻る
        </a>
      </div>
    </section>
  </div>
</Layout>

<style>
  /* Line clamp utilities for news content */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .black-bar {
    width: 5vw;
    min-width: 40px;
    height: 1px;
    background: #1d453c;
    display: block;
    border-radius: 1px;
  }

  /* うすい縦線を背景に敷く */
  .grid-lines {
    background-image: repeating-linear-gradient(
      to right,
      rgba(241, 236, 222, 0.10) 0px,
      rgba(241, 236, 222, 0.10) 1px,
      transparent 1px,
      transparent 120px
    );
    background-attachment: fixed;
  }
</style>
